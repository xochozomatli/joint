C
C   THIS PROGRAM COMPUTES THE ATTRACTION OF BOTH GRAVITY AND MAGNETICS
C   FOR A SINGLE BODY AND INVERTS TO FIT THE SOLUTION. L. SERPA 9-12-79
C
      
      PROGRAM DRIVER 
      COMMON/INV/DIST(75),NSTAT,GRAV(75),GTOT(75),MAG(75),MTOT(75),NPOLY
     1,NSIDES(12),Z(12,25),X(12,25),ELEV(75),SL(12),DENSTY(12),CT,SUSCP(
     212),NBASE,IAN
      COMMON/N2/ PXCF,PZCF,QCF
      REAL INCL,MAG
      WRITE(6,1000)
 1000 FORMAT(' THROUGHOUT THIS PROGRAM 1=NO, 0=YES')
      WRITE(6,100)
  100 FORMAT(' INPUT PROFILE IDENTIFICATION')
      READ(5,101)PROFIL
  101 FORMAT(13A6)
      WRITE(6,102)
  102 FORMAT(' INPUT NO. POLYGONS IN MODEL')
      READ(5,103)NPOLY
  103 FORMAT(i5)
      WRITE(6,104)
  104 FORMAT(' INPUT THE UNITS OF DISTANCE TO BE USED. KM=0,MI=1,KF=2')
      READ(5,103)NUNITS
      WRITE(6,105)
  105 FORMAT(' STATION AT WHICH THE COMPUTED & OBSERVED VALUES AGREE')
      READ(5,103)NBASE
      WRITE(6,106)
  106 FORMAT(' DO YOU WISH TO MODEL GRAVITY(0),MAGNETICS(1), BOTH(2)?')
      WRITE(6,109)
  109 FORMAT(' INPUT AMBIENT FIELD,INCLINATION,AZIMUTH, TYPE OF MAGNETIC
     * FIELD DATA         TOTAL = 1,VERTICAL = 2')
      READ(5,*)AMBF,INCL,ANG,ITYP ! 113
      WRITE(6,107)
  107 FORMAT(' TOTAL NO. OF STATIONS IN PROFILE')
      READ(5,103)NSTAT
      WRITE(6,108)
  108 FORMAT(' INPUT GRAVITY,MAGNETIC VALUE,DISTANCE, ALTITUDE')
      DO 1 I=1,NSTAT
      READ(5,103)GRAV(I),MAG(I),DIST(I),ELEV(I)
   1  CONTINUE
C
C   CONVERT DEGREES TO RADIANS
C
      INCL=INCL/57.3
      ANG=ANG/57.3
      IF(ITYP.EQ.2)GO TO 995
      PXC=COS(INCL)*COS(INCL)*COS(2.*ANG)
      QC=COS(ANG)*SIN(2.*INCL)
      PZC=COS(INCL)**2*SIN(ANG)**2-SIN(INCL)**2
      GO TO 994
 995  CONTINUE
      PXC=0.
      QC=COS(ANG)*COS(INCL)
      PZC=-SIN(INCL)
 994  CONTINUE
      CC=200000.*AMBF
      PXCF=PXC*CC
      QCF=QC*CC
      PZCF=PZC*CC
      G=6.6666667E-08
      IF(NUNITS.EQ.0)CNST=1.E 08
      IF(NUNITS.EQ.1)CNST=1.E 05
      IF(NUNITS.EQ.2)CNST=0.304801E 08
      CT=G*CNST
C
C ****BODY INPUT****
C
      DO 3 I=1,NPOLY
      WRITE(6,111)
      READ(5,103) NSIDES(I),DENSTY(I),SUSCP(I),SL(I)
      NV=NSIDES(I)+1
      WRITE(6,112)
      DO 4 J=1,NV
   4  READ(5,103)X(I,J),Z(I,J)
   3  CONTINUE
      DO 12 I=1,NPOLY
      WRITE(6,114)I,DENSTY(I),SUSCP(I),SL(I)
      WRITE(6,115)
      NS=NSIDES(I)+1
      DO 13 J=1,NS
      WRITE(6,116)X(I,J),Z(I,J),I,J
 13   CONTINUE
 12   CONTINUE
C
C ****START MODEL****
C
      WRITE(6,124)
      READ(5,103)IAN
      IF(IAN.GT.0)GO TO 992
      WRITE(6,125)
      READ(5,103)ITER
      GO TO 982
 992  ITER=0
 982  CONTINUE
      CALL INVER(ITER)
C
C ****PLOTS PROFILE****
C
      WRITE(6,123)
      READ(5,103)IANS
      IF(IANS.GT.0)GO TO 993
 993  CONTINUE
 111  FORMAT(' INPUT NO. OF SIDES,DENSITY,SUSCEPTIBILITY CONTRAST,STRIK
     *E LENGTH')
 112  FORMAT(' INPUT X,Z COORDINATE FOR EACH VERTEX')
 113  FORMAT(3f10.5,i5)
 114  FORMAT(1H0,5X,'POLYGON NO.',I2,5X,'DENSITY',F10.5,' SUSCEPTIBILITY
     * ',F10.5,'          STRIKE LENGTH ',F10.5)
 115  FORMAT(1H,5X,'X VERTICES',5X,'Z VERTICES',6X,'REF')
 116  FORMAT(1H,4X,F10.3,4X,F10.3,4X,I2,1X,I2)
 123  FORMAT(' DO YOU WISH A PLOT? YES=0,NO=1')
 124  FORMAT(' DO YOU WISH TO INVERT THIS MODEL? YES=0,NO=1')
 125  FORMAT(' HOW MANY ITERATIONS?')
      STOP
      END  
